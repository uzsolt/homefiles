#!/usr/bin/env bash

. /home/zsolt/.config/herbstluftwm/include.sh

function create_chains() {
    eval "declare -A c="${1#*=}
    local del=""
    for x in "${!c[@]}"; do
        del="${del} ${chain} keyunbind ${x}"
    done
    del="${del} ${chain} keyunbind Escape ${chain} emit_hook ${hook_leave_keychain}"
    for x in "${!c[@]}"; do
        echo " ${chainm} keybind ${x}" chain ${del} \
            "${chain} ${c[${x}]}" 
    done
    echo " ${chainm} keybind Escape chain ${del}"
}

# $1 - hotkey to activite keychain
# $2 - associative array (hash): index is hotkey, value is command
# $3 - name of keychain
function create_keychain() {
    hc keybind $1 chain ${chainm} emit_hook ${hook_enter_keychain} $3 \
        $(create_chains "$2")
}

declare -A kc_term
URXVT_CONFIG="spawn urxvt-config "
kc_term=(
    [a]="${URXVT_CONFIG} arch"
    [b]="${URXVT_CONFIG} freebsd"
    [d]="${URXVT_CONFIG} dox"
    [n]="${URXVT_CONFIG} bashburn tmux -L burn -2 new-session; source-file /home/zsolt/.config/tmux/tmux-burn.conf"
    [t]="${URXVT_CONFIG} torrent transmission-remote-cli"
    [v]="${URXVT_CONFIG} devel"
    [x]="${URXVT_CONFIG} main"
)

declare -A kc_tag
kc_tag=(
    [x]="use term"
    [w]="use web"
    [r]="use rss"
    [d]="use dox"
    [v]="use dev"
    [t]="use torrent"
    [b]="use bsd"
    [l]="use lowr"
    [i]="use loimp"
    [m]="use music"
)

declare -A kc_move_tag
kc_move_tag=(
    [x]="move term"
    [w]="move web"
    [r]="move rss"
    [d]="move dox"
    [v]="move dev"
    [t]="move torrent"
    [b]="move bsd"
    [l]="move lowr"
    [i]="move loimp"
    [m]="move music"
)

declare -A kc_web
kc_web=(
    [g]="spawn  firefox mail.google.com/mail/u/0/#search/l%3Aunread"
    [h]="spawn  firefox hup.hu/user/4277/track"
    [m]="spawn  firefox www.bgrg.mozanaplo.hu"
    [f]="spawn  firefox www.facebook.com"
)

declare -A kc_list
kc_list=(
    [t]="spawn /home/zsolt/.config/herbstluftwm/scripts/change_tag.sh"
    [c]="spawn /home/zsolt/.config/herbstluftwm/scripts/change_client.sh"
    [a]="spawn /home/zsolt/.config/herbstluftwm/scripts/my-dmenu"
    [m]="spawn /home/zsolt/.config/herbstluftwm/scripts/mpd-playlist.sh"
)

declare -A kc_munkakoz
kc_munkakoz=(
    [n]="spawn /home/zsolt/.config/herbstluftwm/scripts/munkakoz_nevezes_lista"
)

declare -A kc_split
kc_split=(
    [h]="split horizontal 0.5"
    [v]="split vertical 0.5"
    [r]="remove"
)

declare -A kc_move_frame
kc_move_frame=(
    [Left]="shift left"
    [l]="shift right"
)

declare -A kc_layout
float_off="chain + floating off + "
kc_layout=(
    [v]="${float_off} set_layout vertical"
    [h]="${float_off} set_layout horizontal"
    [m]="${float_off} set_layout max"
    [g]="${float_off} set_layout grid"
    [r]="rotate"
    [f]="floating on"
)

create_keychain "${Winkey}+x" "$(declare -p kc_term)" "terminal"
create_keychain "${Winkey}+t" "$(declare -p kc_tag)" "change tag"
create_keychain "${Winkey}+m" "$(declare -p kc_move_tag)" "move to tag"
create_keychain "${Winkey}+w" "$(declare -p kc_web)" "open web"
create_keychain "${Winkey}+k" "$(declare -p kc_munkakoz)" "munkak√∂z"
create_keychain "${Winkey}+l" "$(declare -p kc_list)" "get list"
create_keychain "${Winkey}+s" "$(declare -p kc_split)" "split"
create_keychain "${Winkey}+f" "$(declare -p kc_move_frame)" "move frame"
create_keychain "${Winkey}+a" "$(declare -p kc_layout)" "layout"

